<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="built.css">
    <title>research tempest</title>
</head>
<body class="flex flex-col justify-center items-center">
  <h1 class="text-2xl font-bold text-black">AP Seminar oneSearch</h1>

    <div class="flex justify-center items-center mt-6 w-2/5 h-1/3">
        <div id="searchForm">
            <input type="text" id="searchInput" class="p-1 m-2 w-96 text-black rounded-sm border-2 border-solid border-slate-800" name="query" required>
            <button id="submitBtn" type="button" class="p-2 m-2 text-white bg-emerald-500 shadow-lg rounded-lg hover:scale[1.01]" onclick="sendSearchRequest()">Search</button>
        </div>
        
    </div>
    <div id="results" class="grid grid-cols-2 gap-6 mt-6 w-3/4">

    </div>

    <script>
     
      function sendSearchRequest() {
        
        const inputValue = document.getElementById('searchInput').value;
        if (inputValue.trim() !== '') {
          let smb = document.getElementById('submitBtn');
        smb.setAttribute('disabled', 'true');
        smb.innerHTML = '<span class="loading loading-spinner loading-xs"></span>'
          fetch('http://localhost:3000/search', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'query=' + encodeURIComponent(inputValue),
          })
          .then(response => response.text())
          .then(data => {
            console.log('Server response:', data);
            appendArticles(data);
            smb.removeAttribute('disabled');
        smb.innerHTML = 'Search'
          })
          .catch(error => console.error('Error:', error));
        } else {
          alert('please enter a query')
          return;
        }
      }

      function appendArticles(data) {
        data = JSON.parse(data)
        data.forEach(entry => {
          const template = `
          <div class="p-4 w-full h-fit bg-slate-100">
            <h1 class="text-sm text-slate-500">${entry.origin}</h1>
            <h1 class="text-lg text-black">${entry.title}</h1>
            <h1 class="text-md text-slate-600">DOI: <a href="${entry.doi}" target="_blank" class="underline">${entry.doi}</a></h1>
          </div>
          `
          document.getElementById('results').insertAdjacentHTML('beforeend', template)
        });
      }
    </script>
</body>
</html>