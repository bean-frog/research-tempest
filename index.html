<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="built.css">
    <title>research tempest</title>
</head>
<body class="flex flex-col justify-center items-center">
  <h1 class="text-2xl font-bold text-black">AP Seminar oneSearch</h1>

    <div class="flex justify-center items-center mt-6 w-2/5 h-1/3">
        <div id="searchForm">
            <input type="text" id="searchInput" class="p-1 m-2 w-96 text-black rounded-sm border-2 border-solid border-slate-800" name="query" required>
            <button id="submitBtn" type="button" class="p-2 m-2 text-white bg-emerald-500 shadow-lg rounded-lg hover:scale[1.01]" onclick="sendSearchRequest()">Search</button>
        </div>
    </div>
    <h1 id='pbp' class="text-sm text-slate-700">Be patient after searching, scraping the sites takes a while. <a target="_blank" class="underline" href="whysolong.txt">Why?</a></h1>
    <h1 id="links" class="hidden text-sm text-black">View your search on: <a target="_blank" class="underline" id="links-liebert">LiebertPub</a>, <a target="_blank" class="underline" id="links-sage">Sage Journals</a>, <a target="_blank" class="underline" id="links-scidirect">ScienceDirect</a>, <a target="_blank" class="underline" id="links-nihpm">NIH PubMed</a></h1>

    <div id="results" class="grid grid-cols-2 gap-6 mt-6 w-3/4">

    </div>

    <script>
     
      function sendSearchRequest() {
        
        const inputValue = document.getElementById('searchInput').value;
        if (inputValue.trim() !== '') {
          let smb = document.getElementById('submitBtn');
        smb.setAttribute('disabled', 'true');
        smb.innerHTML = '<span class="loading loading-spinner loading-xs"></span>'
          fetch('http://localhost:3000/search', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'query=' + encodeURIComponent(inputValue),
          })
          .then(response => response.text())
          .then(data => {
            console.log('Server response:', data);
            appendArticles(data);
            displayLinks(inputValue)
            smb.removeAttribute('disabled');
        smb.innerHTML = 'Search'
          })
          .catch(error => console.error('Error:', error));
        } else {
          alert('please enter a query')
          return;
        }
      }

      function appendArticles(data) {
         document.getElementById('results').innerHTML = ''
        data = JSON.parse(data)
        data.forEach(entry => {
          const template = `
          <div class="p-4 w-full h-fit bg-slate-100">
            <h1 class="text-sm text-slate-500">${entry.origin}</h1>
            <h1 class="text-lg text-black">${entry.title}</h1>
            <h1 class="text-md text-slate-600">DOI: <a href="${entry.doi}" target="_blank" class="underline">${entry.doi}</a></h1>
          </div>
          `
          document.getElementById('results').insertAdjacentHTML('beforeend', template)
        });
      }
      function displayLinks(query){
        let links = document.getElementById('links');
        let liebert = document.getElementById('links-liebert');
        let sage = document.getElementById('links-sage');
        let scidir = document.getElementById('links-scidirect');
        let nihpm = document.getElementById('links-nihpm');
        if (links.classList.contains('hidden')) {
          links.classList.remove('hidden');
        }
        query = query.trim().replace(/\s+/g, '+');
        var liebertHref = `https://www.liebertpub.com/action/doSearch?AllField=${query}&pagesize=100`
        liebert.setAttribute('href', liebertHref)
        var sageHref = `https://journals.sagepub.com/action/doSearch?AllField=${query}&startPage=0&rel=&access=user&pageSize=100`
        sage.setAttribute('href', sageHref)
        var scidirHref = `https://www.sciencedirect.com/search?qs=${query}&show=100&accessTypes=openaccess`;
        scidir.setAttribute('href', scidirHref)
        var nihpmHref = `https://pubmed.ncbi.nlm.nih.gov/?term=${query}&filter=simsearch2.ffrft&size=100`;
        nihpm.setAttribute('href', nihpmHref)
      }
    </script>
</body>
</html>